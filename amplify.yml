version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 22
        - nvm use 22
        - corepack enable
        - corepack prepare pnpm@latest --activate
        # Install root deps first
        - pnpm install --frozen-lockfile
        # Prune only studio (no --docker to avoid missing files issue)
        - pnpm dlx turbo prune studio --out-dir=out
        - cd out && pnpm install --frozen-lockfile
    build:
      commands:
        # Build only studio app
        - cd out && pnpm run build --filter=studio...
  artifacts:
    baseDirectory: out/apps/studio/.next   # ðŸ‘ˆ pruned output Next.js build dir
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .pnpm-store/**/*
      - out/node_modules/**/*
